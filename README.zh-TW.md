# Medical Calculator MCP Server ğŸ¥ (ç¹é«”ä¸­æ–‡)

ç‚º AI Agent æä¾›é†«å­¸è¨ˆç®—å·¥å…·çš„ MCP ä¼ºæœå™¨ï¼Œæ¡ç”¨ DDD æ´‹è”¥æ¶æ§‹è¨­è¨ˆã€‚

[English Version](README.md)

[![Python 3.11+](https://img.shields.io/badge/python-3.11+-blue.svg)](https://www.python.org/downloads/)
[![MCP SDK](https://img.shields.io/badge/MCP-FastMCP-green.svg)](https://github.com/modelcontextprotocol/python-sdk)
[![License](https://img.shields.io/badge/license-Apache%202.0-blue.svg)](LICENSE)
[![CI](https://github.com/u9401066/medical-calc-mcp/actions/workflows/ci.yml/badge.svg)](https://github.com/u9401066/medical-calc-mcp/actions/workflows/ci.yml)
[![Tests](https://img.shields.io/badge/tests-1639%20passed-brightgreen.svg)](#-é–‹ç™¼æŒ‡å—)
[![Code Style](https://img.shields.io/badge/code%20style-ruff-orange.svg)](https://github.com/astral-sh/ruff)
[![Architecture](https://img.shields.io/badge/architecture-DDD%20Onion-purple.svg)](#-æ¶æ§‹)
[![PRs Welcome](https://img.shields.io/badge/PRs-welcome-brightgreen.svg)](http://makeapullrequest.com)

---

## ğŸ“– ç›®éŒ„

- [ç‰¹è‰²åŠŸèƒ½](#-ç‰¹è‰²åŠŸèƒ½)
- [ç‚ºä»€éº¼éœ€è¦é€™å€‹å°ˆæ¡ˆï¼Ÿ](#-ç‚ºä»€éº¼éœ€è¦é€™å€‹å°ˆæ¡ˆ)
- [æ¶æ§‹](#-æ¶æ§‹)
- [å¿«é€Ÿé–‹å§‹](#-å¿«é€Ÿé–‹å§‹)
- [éƒ¨ç½²æ¨¡å¼](#-éƒ¨ç½²æ¨¡å¼) ğŸš€ NEW
- [Agent æ•´åˆ](#-agent-æ•´åˆ) ğŸ¤– NEW
- [Docker éƒ¨ç½²](#-docker-éƒ¨ç½²) ğŸ³
- [HTTPS éƒ¨ç½²](#-https-éƒ¨ç½²) ğŸ”’ NEW
- [REST API æ¥å£](#-rest-api-æ¥å£) ğŸŒ NEW
- [å®‰å…¨æ€§](#-å®‰å…¨æ€§) ğŸ” NEW
- [å·¥å…·æ¢ç´¢](#-å·¥å…·æ¢ç´¢)
- [å¯ç”¨å·¥å…·](#-å¯ç”¨å·¥å…·)
  - [å¿«é€Ÿå°è¦½](#-å¿«é€Ÿå°è¦½)
  - [éº»é†‰ç§‘ / è¡“å‰è©•ä¼°](#-éº»é†‰ç§‘--è¡“å‰è©•ä¼°)
  - [é‡ç—‡åŠ è­·](#-é‡ç—‡åŠ è­·)
  - [å°å…’ç§‘](#-å°å…’ç§‘)
  - [è…è‡Ÿç§‘](#-è…è‡Ÿç§‘)
  - [èƒ¸è…”ç§‘](#-èƒ¸è…”ç§‘)
  - [å¿ƒè‡Ÿç§‘](#-å¿ƒè‡Ÿç§‘)
  - [è¡€æ¶²ç§‘](#-è¡€æ¶²ç§‘)
  - [æ€¥è¨ºé†«å­¸](#-æ€¥è¨ºé†«å­¸)
  - [è‚è†½ç§‘](#-è‚è†½ç§‘)
  - [é…¸é¹¼ä»£è¬](#-é…¸é¹¼ä»£è¬)
  - [æ¢ç´¢å·¥å…·](#-æ¢ç´¢å·¥å…·)
  - [æç¤ºè©å·¥ä½œæµç¨‹](#-æç¤ºè©å·¥ä½œæµç¨‹)
- [ä½¿ç”¨ç¯„ä¾‹](#-ä½¿ç”¨ç¯„ä¾‹)
- [åƒè€ƒæ–‡ç»](#-åƒè€ƒæ–‡ç»)
- [é–‹ç™¼æŒ‡å—](#-é–‹ç™¼æŒ‡å—)
- [éƒ¨ç½²æŒ‡å—](docs/DEPLOYMENT.md) ğŸ“˜
- [è·¯ç·šåœ–](ROADMAP.md)

---

## ğŸ¯ ç‰¹è‰²åŠŸèƒ½

- **ğŸ”Œ MCP åŸç”Ÿæ•´åˆ**ï¼šä½¿ç”¨ FastMCP SDKï¼Œèˆ‡ AI Agent ç„¡ç¸«æ•´åˆ
- **ğŸ” æ™ºæ…§å·¥å…·æ¢ç´¢**ï¼šé›™å±¤ Key ç³»çµ±ï¼ˆLow/High Levelï¼‰ï¼Œè®“ AI æ™ºæ…§é¸æ“‡å·¥å…·
- **ğŸ—ï¸ ä¹¾æ·¨ DDD æ¶æ§‹**ï¼šæ´‹è”¥å¼æ¶æ§‹ï¼Œé—œæ³¨é»åˆ†é›¢æ¸…æ™°
- **ğŸ“š å¾ªè­‰é†«å­¸**ï¼šæ‰€æœ‰å…¬å¼å‡å¼•ç”¨åŸå§‹åŒå„•å¯©æŸ¥è«–æ–‡ï¼ˆVancouver æ ¼å¼ï¼‰
- **ğŸ”’ å‹åˆ¥å®‰å…¨**ï¼šå®Œæ•´ Python å‹åˆ¥æç¤ºï¼Œä½¿ç”¨ dataclass å¯¦é«”
- **ğŸŒ é›™èªæ”¯æ´**ï¼šä¸­è‹±æ–‡æ–‡æª”èˆ‡å·¥å…·èªªæ˜

---

## ğŸ¤” ç‚ºä»€éº¼éœ€è¦é€™å€‹å°ˆæ¡ˆï¼Ÿ

### å•é¡Œ

ç•¶ AI Agentï¼ˆå¦‚ Claudeã€GPTï¼‰éœ€è¦é€²è¡Œé†«å­¸è¨ˆç®—æ™‚ï¼Œæœƒé‡åˆ°ä»¥ä¸‹æŒ‘æˆ°ï¼š

1. **å¹»è¦ºé¢¨éšª | Hallucination Risk**: LLMs å¯èƒ½æœƒç”¢ç”ŸéŒ¯èª¤çš„å…¬å¼æˆ–æ•¸å€¼
2. **ç‰ˆæœ¬æ··æ·† | Version Confusion**: åŒä¸€è¨ˆç®—å™¨æœ‰å¤šå€‹ç‰ˆæœ¬ï¼ˆä¾‹å¦‚ MELD vs MELD-Na vs MELD 3.0ï¼‰
3. **ç¼ºä¹æ¢ç´¢æ©Ÿåˆ¶ | No Discovery Mechanism**: Agent å¦‚ä½•çŸ¥é“è©²ä½¿ç”¨å“ªå€‹å·¥å…·é€²è¡Œã€Œå¿ƒè‡Ÿé¢¨éšªè©•ä¼°ã€ï¼Ÿ

### è§£æ±ºæ–¹æ¡ˆ

æœ¬å°ˆæ¡ˆæä¾›ï¼š

| ç‰¹è‰² | èªªæ˜ |
|---------|------|
| **é©—è­‰éçš„è¨ˆç®—å™¨** | ç¶“åŒå„•å¯©æŸ¥ã€æ¸¬è©¦é©—è­‰çš„å…¬å¼ |
| **å·¥å…·æ¢ç´¢** | AI å¯ä¾å°ˆç§‘ã€ç—…æ³æˆ–è‡¨åºŠå•é¡Œæœå°‹ |
| **MCP å”å®š** | AI-å·¥å…·é€šè¨Šçš„æ¨™æº–å”å®š |
| **è«–æ–‡å¼•ç”¨** | æ¯å€‹è¨ˆç®—å™¨éƒ½å¼•ç”¨åŸå§‹ç ”ç©¶ |

---

## ğŸ—ï¸ æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    infrastructure/mcp/                       â”‚
â”‚                (MCP Server, Handlers, Resources)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  MedicalCalculatorServer                             â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ handlers/DiscoveryHandler (discover, list...)   â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ handlers/CalculatorHandler (calculate_*)        â”‚    â”‚
â”‚  â”‚  â””â”€â”€ resources/CalculatorResourceHandler             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ uses
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     application/                             â”‚
â”‚               (Use Cases, DTOs, Validation)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  DiscoveryUseCase, CalculateUseCase                  â”‚    â”‚
â”‚  â”‚  DiscoveryRequest/Response, CalculateRequest/Responseâ”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ depends on
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       domain/                                â”‚
â”‚            (Entities, Services, Value Objects)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  BaseCalculator, ToolMetadata, ScoreResult          â”‚    â”‚
â”‚  â”‚  LowLevelKey, HighLevelKey, ToolRegistry            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                    ã€æ ¸å¿ƒå±¤ï¼Œé›¶ä¾è³´ã€‘                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é—œéµè¨­è¨ˆæ±ºç­–

| æ±ºç­– | æ±ºç­–ç†ç”± |
|----------|-----------|
| **DDD æ´‹è”¥æ¶æ§‹** | é ˜åŸŸé‚è¼¯èˆ‡åŸºç¤è¨­æ–½éš”é›¢ |
| **FastMCP** | åŸç”Ÿ Python MCP SDKï¼Œç°¡æ½”è£é£¾å™¨ API |
| **Dataclasses** | ä¸å¯è®Šã€å‹åˆ¥å®‰å…¨çš„å¯¦é«” |
| **é›™å±¤ Key ç³»çµ±** | åŒæ™‚æ”¯æ´ç²¾ç¢ºæŸ¥æ‰¾èˆ‡æ¢ç´¢å¼ç™¼ç¾ |
| **åˆ†å±¤é©—è­‰** | ä¸‰å±¤é©—è­‰æ¶æ§‹ (MCP/Application/Domain) |

### é©—è­‰æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬ä¸€å±¤: MCP (åŸºç¤è¨­æ–½å±¤)                                      â”‚
â”‚  â””â”€â”€ Pydantic + JSON Schema: å‹åˆ¥é©—è­‰                        â”‚
â”‚      (ç”± Annotated[type, Field(description)] è‡ªå‹•ç”Ÿæˆ)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¬¬äºŒå±¤: Application (æ‡‰ç”¨å±¤/Use Case)                        â”‚
â”‚  â””â”€â”€ ParameterValidator: è¨ˆç®—å‰åƒæ•¸é©—è­‰                       â”‚
â”‚      (é‡å° 22 ç¨®åƒæ•¸å®šç¾©åˆæ³•ç¯„åœ)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¬¬ä¸‰å±¤: Domain (é ˜åŸŸå±¤/è¨ˆç®—å™¨)                                â”‚
â”‚  â””â”€â”€ é†«å­¸é‚è¼¯é©—è­‰                                            â”‚
â”‚      (è‡¨åºŠè¦å‰‡ã€å…¬å¼é™åˆ¶æ¢ä»¶)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é ˜åŸŸé©—è­‰æ¨¡çµ„** (`src/domain/validation/`):
- `rules.py`: åŸºç¤é¡åˆ¥ (RangeRule, EnumRule, TypeRule, CustomRule)
- `parameter_specs.py`: 22 ç¨®é†«å­¸åƒæ•¸è¦æ ¼
- `validators.py`: åŒ…å« `validate_params()` å‡½å¼çš„ ParameterValidator

---

## ğŸš€ å¿«é€Ÿé–‹å§‹

### å‰ç½®éœ€æ±‚

- Python 3.11+ (MCP SDK è¦æ±‚)
- pip æˆ– uv å¥—ä»¶ç®¡ç†å·¥å…·

### å®‰è£

```bash
# è¤‡è£½å„²å­˜åº«
git clone https://github.com/u9401066/medical-calc-mcp.git
cd medical-calc-mcp

# å»ºç«‹è™›æ“¬ç’°å¢ƒï¼ˆå»ºè­°ï¼‰
python -m venv .venv
source .venv/bin/activate  # Linux/Mac
# æˆ–
.venv\Scripts\activate     # Windows

# å®‰è£ä¾è³´
pip install -r requirements.txt
```

### åŸ·è¡Œ MCP ä¼ºæœå™¨

```bash
# å•Ÿå‹• MCP ä¼ºæœå™¨ï¼ˆstdio å‚³è¼¸ï¼‰
python -m src.infrastructure.mcp.server

# æˆ–ä½¿ç”¨ MCP é–‹ç™¼æª¢æŸ¥å™¨ (Inspector)
pip install "mcp[cli]"
mcp dev src/infrastructure/mcp/server.py
```

### èˆ‡ VS Code Copilot æ•´åˆ â­ NEW

å°ˆæ¡ˆå·²åŒ…å« `.vscode/mcp.json` è¨­å®šæª”ï¼Œå¯ç„¡ç¸«æ•´åˆ VS Code Copilotã€‚

**è‡ªå‹•è¨­å®š:**

åªéœ€åœ¨ VS Code é–‹å•Ÿæ­¤å°ˆæ¡ˆï¼ŒMCP ä¼ºæœå™¨æœƒè‡ªå‹•è¢«ç™¼ç¾ï¼

```json
// .vscode/mcp.json (åŒ…å«åœ¨å„²å­˜åº«ä¸­)
{
  "servers": {
    "medical-calc-mcp": {
      "type": "stdio",
      "command": "uv",
      "args": ["run", "python", "-m", "medical_calc_mcp"]
    }
  }
}
```

**åœ¨ VS Code å•Ÿç”¨ MCP:**

1. é–‹å•Ÿ VS Code è¨­å®š (Ctrl+,)
2. æœå°‹ `chat.mcp`
3. å•Ÿç”¨ `Chat: Mcp Discovery Enabled`
4. é‡æ–°å•Ÿå‹• VS Code

**ä½¿ç”¨æ–¹å¼:**

åœ¨ GitHub Copilot Chat ä¸­ï¼Œä½¿ç”¨ `@medical-calc-mcp` å­˜å–è¨ˆç®—å™¨ï¼š

```
@medical-calc-mcp Calculate SOFA score with PaO2/FiO2=200, platelets=80...
```

### èˆ‡ Claude Desktop æ•´åˆ

å°‡ä»¥ä¸‹å…§å®¹åŠ å…¥ `claude_desktop_config.json`ï¼š

```json
{
  "mcpServers": {
    "medical-calc": {
      "command": "python",
      "args": ["-m", "src.infrastructure.mcp.server"],
      "cwd": "/path/to/medical-calc-mcp"
    }
  }
}
```

---

## ğŸš€ éƒ¨ç½²æ¨¡å¼ â­ NEW

æœ¬å°ˆæ¡ˆæ”¯æ´å¤šç¨®éƒ¨ç½²æ¨¡å¼ï¼Œå¯æ ¹æ“šä½¿ç”¨å ´æ™¯é¸æ“‡ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            éƒ¨ç½²é¸é …                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   REST API      â”‚   MCP SSE       â”‚   MCP stdio                     â”‚
â”‚   (é€£æ¥åŸ  8080)  â”‚   (é€£æ¥åŸ  8000)  â”‚   (æœ¬åœ°)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… ä»»ä½• HTTP     â”‚ âœ… MCP å®¢æˆ¶ç«¯    â”‚ âœ… Claude Desktop               â”‚
â”‚    å®¢æˆ¶ç«¯        â”‚    (é ç«¯)       â”‚ âœ… VS Code Copilot              â”‚
â”‚ âœ… è‡ªå®šç¾© Agent  â”‚ âœ… Docker/é›²ç«¯   â”‚ âœ… MCP Inspector                â”‚
â”‚ âœ… Web æ‡‰ç”¨      â”‚                 â”‚                                 â”‚
â”‚ âœ… Python/JS    â”‚                 â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| æ¨¡å¼ | æŒ‡ä»¤ | é€£æ¥åŸ  | é©ç”¨å ´æ™¯ |
|------|---------|------|----------|
| **api** | `python src/main.py --mode api` | 8080 | è‡ªå®šç¾© Agentã€Web æ‡‰ç”¨ã€è…³æœ¬ |
| **sse** | `python src/main.py --mode sse` | 8000 | é ç«¯ MCP å®¢æˆ¶ç«¯ã€Docker |
| **stdio** | `python src/main.py --mode stdio` | - | æœ¬åœ° Claude Desktopã€VS Code |

> ğŸ“˜ è©³ç´°éƒ¨ç½²æŒ‡å—è«‹åƒé–± [docs/DEPLOYMENT.md](docs/DEPLOYMENT.md)

---

## ğŸ¤– Agent æ•´åˆ â­ NEW

### Python Agent ç¯„ä¾‹

```python
import requests

class MedicalCalculatorClient:
    def __init__(self, base_url: str = "http://localhost:8080"):
        self.api_url = f"{base_url}/api/v1"
    
    def search(self, query: str) -> list:
        r = requests.get(f"{self.api_url}/search", params={"q": query})
        return r.json()
    
    def calculate(self, tool_id: str, params: dict) -> dict:
        r = requests.post(f"{self.api_url}/calculate/{tool_id}", json={"params": params})
        return r.json()

# ä½¿ç”¨æ–¹å¼
client = MedicalCalculatorClient()

# æœå°‹æ•—è¡€ç—‡ç›¸é—œè¨ˆç®—å™¨
results = client.search("sepsis")

# è¨ˆç®— SOFA åˆ†æ•¸
result = client.calculate("sofa", {
    "pao2_fio2_ratio": 200,
    "platelets": 100,
    "bilirubin": 2.0,
    "gcs_score": 13,
    "creatinine": 2.5
})
print(f"SOFA Score: {result['result']['value']}")
```

### LangChain / OpenAI Function Calling

é—œæ–¼ LangChain èˆ‡ OpenAI æ•´åˆç¯„ä¾‹ï¼Œè«‹åƒé–± [docs/DEPLOYMENT.md](docs/DEPLOYMENT.md#-agent-integration-examples--agent-æ•´åˆç¯„ä¾‹)ã€‚

### å¿«é€Ÿ API æ¸¬è©¦

```bash
# å•Ÿå‹• API ä¼ºæœå™¨
python src/main.py --mode api --port 8080

# æ¸¬è©¦ç«¯é»
curl http://localhost:8080/health
curl "http://localhost:8080/api/v1/search?q=sepsis"
curl -X POST "http://localhost:8080/api/v1/calculate/gcs" \
  -H "Content-Type: application/json" \
  -d '{"params": {"eye_response": 4, "verbal_response": 5, "motor_response": 6}}'
```

---

## ğŸ³ Docker éƒ¨ç½² â­ NEW

MCP ä¼ºæœå™¨å¯é€é Docker ä½œç‚º**é ç«¯ SSE (Server-Sent Events) ä¼ºæœå™¨**åŸ·è¡Œï¼Œæ”¯æ´ï¼š
- ğŸŒ å¾ä»»ä½• MCP ç›¸å®¹å®¢æˆ¶ç«¯é ç«¯å­˜å–
- â˜ï¸ é›²ç«¯éƒ¨ç½²ï¼ˆAWSã€GCPã€Azure ç­‰ï¼‰
- ğŸ”„ ä½¿ç”¨ Docker Compose æˆ– Kubernetes è¼•é¬†æ“´å±•

### ä½¿ç”¨ Docker å¿«é€Ÿé–‹å§‹

```bash
# å»ºæ§‹ä¸¦åŸ·è¡Œ
docker-compose up -d

# æˆ–æ‰‹å‹•å»ºæ§‹
docker build -t medical-calc-mcp .
docker run -p 8000:8000 medical-calc-mcp

# æª¢æŸ¥æœå‹™æ˜¯å¦é‹è¡Œ
curl -sf http://localhost:8000/sse -o /dev/null && echo "OK"
```

### å‚³è¼¸æ¨¡å¼

| æ¨¡å¼ | é©ç”¨å ´æ™¯ | é€£æ¥åŸ  | æŒ‡ä»¤ |
|------|----------|------|---------|
| `stdio` | æœ¬åœ° Claude Desktop | - | `python -m src.main` |
| `sse` | é ç«¯ MCP (Docker/é›²ç«¯) | 8000 | `python -m src.main --mode sse` |
| `http` | å¯ä¸²æµçš„ HTTP å‚³è¼¸ | 8000 | `python -m src.main --mode http` |

> âš ï¸ **é‡è¦**: SSE/HTTP æ¨¡å¼é è¨­ç¶å®šåˆ° `0.0.0.0` ä»¥ä¾¿é ç«¯å­˜å–ã€‚

### å¿«é€Ÿå•Ÿå‹•æŒ‡ä»¤

```bash
# 1. STDIO æ¨¡å¼ - ç”¨æ–¼ Claude Desktop (æœ¬åœ°)
python -m src.main

# 2. SSE æ¨¡å¼ - ç”¨æ–¼é ç«¯ Agent (Docker/é›²ç«¯)
python -m src.main --mode sse
python -m src.main --mode sse --host 0.0.0.0 --port 9000  # è‡ªå®šç¾©é€£æ¥åŸ 

# 3. HTTP æ¨¡å¼ - å¯ä¸²æµçš„ HTTP å‚³è¼¸
python -m src.main --mode http
```

### é ç«¯ MCP å®¢æˆ¶ç«¯è¨­å®š

**Claude Desktop (é ç«¯ SSE):**

```json
{
  "mcpServers": {
    "medical-calc": {
      "url": "http://localhost:8000/sse"
    }
  }
}
```

**è‹¥æ˜¯é›²ç«¯éƒ¨ç½²ï¼Œè«‹å°‡ `localhost` æ›¿æ›ç‚ºæ‚¨çš„ä¼ºæœå™¨ä½å€ï¼š**

```json
{
  "mcpServers": {
    "medical-calc": {
      "url": "https://your-server.example.com/sse"
    }
  }
}
```

### API ç«¯é»

> âš ï¸ FastMCP SSE æ¨¡å¼åƒ…æä¾›ä»¥ä¸‹ç«¯é»ï¼š

| ç«¯é» | æ–¹æ³• | èªªæ˜ |
|----------|--------|-------------|
| `/sse` | GET | SSE é€£ç·šç«¯é» |
| `/messages/` | POST | MCP è¨Šæ¯ç«¯é» |

### ç’°å¢ƒè®Šæ•¸

| è®Šæ•¸ | é è¨­å€¼ | èªªæ˜ |
|----------|---------|-------------|
| `MCP_MODE` | `stdio` | å‚³è¼¸æ¨¡å¼ (stdio, sse, http) |
| `MCP_HOST` | `0.0.0.0` | ç¶å®šä¸»æ©Ÿä½å€ |
| `MCP_PORT` | `8000` | ç¶å®šé€£æ¥åŸ  |
| `LOG_LEVEL` | `INFO` | æ—¥èªŒå±¤ç´š |
| `DEBUG` | `false` | å•Ÿå‹•é™¤éŒ¯æ¨¡å¼ |

---

## ğŸ”’ HTTPS éƒ¨ç½² â­ NEW

ç‚ºç”Ÿç”¢ç’°å¢ƒå•Ÿç”¨ HTTPS å®‰å…¨é€šè¨Šã€‚

### æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        HTTPS Deployment                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   â”‚
â”‚   â”‚   å®¢æˆ¶ç«¯    â”‚                                                   â”‚
â”‚   â”‚ (ç€è¦½å™¨/    â”‚                                                   â”‚
â”‚   â”‚  AI Agent)  â”‚                                                   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚
â”‚          â”‚ HTTPS (TLS 1.2/1.3)                                      â”‚
â”‚          â–¼                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   â”‚                    Nginx åå‘ä»£ç†                         â”‚      â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚      â”‚
â”‚   â”‚  â”‚ â€¢ TLS çµ‚ç«¯ (SSL æ†‘è­‰)                                â”‚ â”‚      â”‚
â”‚   â”‚  â”‚ â€¢ é€Ÿç‡é™åˆ¶ (30/60 req/s)                            â”‚ â”‚      â”‚
â”‚   â”‚  â”‚ â€¢ å®‰å…¨æ¨™é ­ (XSS, CSRF é˜²è­·)                          â”‚ â”‚      â”‚
â”‚   â”‚  â”‚ â€¢ SSE å„ªåŒ– (é•·é€£ç·š)                                  â”‚ â”‚      â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                  â”‚ HTTP (å…§éƒ¨)            â”‚ HTTP (å…§éƒ¨)             â”‚
â”‚                  â–¼                        â–¼                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚   â”‚   MCP SSE ä¼ºæœå™¨     â”‚    â”‚   REST API ä¼ºæœå™¨    â”‚              â”‚
â”‚   â”‚   (é€£æ¥åŸ  8000)       â”‚    â”‚   (é€£æ¥åŸ  8080)       â”‚              â”‚
â”‚   â”‚                      â”‚    â”‚                      â”‚              â”‚
â”‚   â”‚ â€¢ /sse               â”‚    â”‚ â€¢ /api/v1/*          â”‚              â”‚
â”‚   â”‚ â€¢ /messages          â”‚    â”‚ â€¢ /docs (Swagger)    â”‚              â”‚
â”‚   â”‚ â€¢ /health            â”‚    â”‚ â€¢ /health            â”‚              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¤–éƒ¨ç«¯é» (HTTPS):
â”œâ”€â”€ https://localhost/        â†’ MCP SSE (é€ç”± Nginx :443)
â”œâ”€â”€ https://localhost/sse     â†’ SSE é€£ç·š
â”œâ”€â”€ https://localhost:8443/   â†’ REST API (é€ç”± Nginx :8443)
â””â”€â”€ https://localhost:8443/docs â†’ Swagger UI

å…§éƒ¨ (HTTP, åƒ… Docker ç¶²çµ¡):
â”œâ”€â”€ http://medical-calc-mcp:8000  â†’ MCP Server
â””â”€â”€ http://medical-calc-api:8080  â†’ API Server
```

### é¸é …ä¸€ï¼šDocker éƒ¨ç½²ï¼ˆæ¨è–¦ï¼‰

é©ç”¨æ–¼ç”Ÿç”¢ç’°å¢ƒå’Œåœ˜éšŠç’°å¢ƒã€‚

```bash
# æ­¥é©Ÿä¸€ï¼šç”Ÿæˆ SSL æ†‘è­‰
chmod +x scripts/generate-ssl-certs.sh
./scripts/generate-ssl-certs.sh

# æ­¥é©ŸäºŒï¼šå•Ÿå‹• HTTPS æœå‹™
./scripts/start-https-docker.sh up

# å…¶ä»–å‘½ä»¤
./scripts/start-https-docker.sh down     # åœæ­¢æœå‹™
./scripts/start-https-docker.sh logs     # æŸ¥çœ‹æ—¥èªŒ
./scripts/start-https-docker.sh restart  # é‡æ–°å•Ÿå‹•
./scripts/start-https-docker.sh status   # æª¢æŸ¥ç‹€æ…‹
```

**ç«¯é»è³‡è¨Šï¼š**

| æœå‹™ | URL | èªªæ˜ |
|---------|-----|-------------|
| MCP SSE | `https://localhost/` | MCP Server-Sent Events |
| MCP SSE | `https://localhost/sse` | SSE é€£ç·š |
| REST API | `https://localhost:8443/` | REST API æ ¹ç›®éŒ„ |
| Swagger UI | `https://localhost:8443/docs` | API æ–‡æª” |
| å¥åº·æª¢æŸ¥ | `https://localhost/health` | MCP å¥åº·æª¢æŸ¥ |
| å¥åº·æª¢æŸ¥ | `https://localhost:8443/health` | API å¥åº·æª¢æŸ¥ |

### é¸é …äºŒï¼šæœ¬åœ°é–‹ç™¼ï¼ˆç„¡ Dockerï¼‰

ä½¿ç”¨ Uvicorn åŸç”Ÿ SSL æ”¯æ´é€²è¡Œå¿«é€Ÿæœ¬åœ°æ¸¬è©¦ã€‚

```bash
# æ­¥é©Ÿä¸€ï¼šç”Ÿæˆ SSL æ†‘è­‰
./scripts/generate-ssl-certs.sh

# æ­¥é©ŸäºŒï¼šå•Ÿå‹• HTTPS æœå‹™
./scripts/start-https-local.sh          # åŒæ™‚å•Ÿå‹• MCP èˆ‡ API
./scripts/start-https-local.sh sse      # åƒ…å•Ÿå‹• MCP SSE
./scripts/start-https-local.sh api      # åƒ…å•Ÿå‹• REST API
```

### é¸é …ä¸‰ï¼šç”Ÿç”¢ç’°å¢ƒä½¿ç”¨ Let's Encrypt

ä½¿ç”¨çœŸå¯¦ç¶²åŸŸåç¨±å’Œå…è²»å—ä¿¡ä»»æ†‘è­‰ã€‚

```bash
# 1. ç·¨è¼¯ nginx/nginx.confï¼Œå–æ¶ˆè¨»è§£é€™äº›è¡Œï¼š
ssl_certificate /etc/letsencrypt/live/your-domain.com/fullchain.pem;
ssl_certificate_key /etc/letsencrypt/live/your-domain.com/privkey.pem;

# 2. ä½¿ç”¨ certbot ç²å–æ†‘è­‰ï¼š
sudo certbot certonly --webroot -w /var/www/certbot \
  -d your-domain.com -d api.your-domain.com

# 3. å•Ÿå‹•æœå‹™
docker-compose -f docker-compose.https.yml up -d
```

### æª”æ¡ˆèªªæ˜

| æª”æ¡ˆ | èªªæ˜ |
|------|-------------|
| `nginx/nginx.conf` | åŒ…å« TLSã€é€Ÿç‡é™åˆ¶åŠ SSE å„ªåŒ–çš„ Nginx é…ç½® |
| `docker-compose.https.yml` | HTTPS éƒ¨ç½²ç”¨çš„ Docker Compose è¨­å®š |
| `scripts/generate-ssl-certs.sh` | ç”Ÿæˆè‡ªç°½å SSL æ†‘è­‰è…³æœ¬ |
| `scripts/start-https-docker.sh` | å•Ÿå‹•/åœæ­¢ Docker HTTPS æœå‹™ |
| `scripts/start-https-local.sh` | å•Ÿå‹•æœ¬åœ° HTTPS (Uvicorn SSL) |

---

## ğŸŒ REST API æ¥å£ â­ NEW

é™¤äº† MCP å”å®šï¼Œä¼ºæœå™¨é‚„æä¾›**ç¨ç«‹çš„ REST API**ï¼Œå¯ç›´æ¥é€é HTTP å­˜å–ã€‚

### å¿«é€Ÿé–‹å§‹

```bash
# å•Ÿå‹• API ä¼ºæœå™¨
python src/main.py --mode api --port 8080

# ä½¿ç”¨ uvicornï¼ˆç”Ÿç”¢ç’°å¢ƒï¼‰
uvicorn src.infrastructure.api.server:app --host 0.0.0.0 --port 8080
```

### API ç«¯é»

| ç«¯é» | æ–¹æ³• | èªªæ˜ |
|----------|--------|-------------|
| `/health` | GET | å¥åº·æª¢æŸ¥ |
| `/api/v1/calculators` | GET | åˆ—å‡ºæ‰€æœ‰è¨ˆç®—å™¨ |
| `/api/v1/calculators/{tool_id}` | GET | å–å¾—è¨ˆç®—å™¨è³‡è¨Š |
| `/api/v1/search?q={keyword}` | GET | æœå°‹è¨ˆç®—å™¨ |
| `/api/v1/specialties` | GET | åˆ—å‡ºæ‰€æœ‰å°ˆç§‘ |
| `/api/v1/specialties/{specialty}` | GET | ä¾å°ˆç§‘åˆ—å‡ºå·¥å…· |
| `/api/v1/calculate/{tool_id}` | POST | åŸ·è¡Œè¨ˆç®— |

---

## ğŸ” å®‰å…¨æ€§ â­ NEW

### å®‰å…¨ç‰¹æ€§

æœ¬å°ˆæ¡ˆå¯¦æ–½å¤šå±¤å®‰å…¨æ©Ÿåˆ¶ï¼š

| å±¤ç´š | ç‰¹æ€§ | èªªæ˜ |
|-------|---------|-------------|
| **HTTPS** | TLS 1.2/1.3 åŠ å¯† | æ‰€æœ‰æµé‡ç¶“ç”± Nginx åŠ å¯† |
| **è¼¸å…¥é©—è­‰** | ä¸‰å±¤é©—è­‰æ©Ÿåˆ¶ | Pydantic â†’ ParameterValidator â†’ é ˜åŸŸè¦å‰‡ |
| **CORS** | å¯é…ç½®ä¾†æº | é€éç’°å¢ƒè®Šæ•¸æ§åˆ¶ç¯„åœ |
| **é€Ÿç‡é™åˆ¶** | Nginx + æ‡‰ç”¨å±¤ | é›™å±¤ä¿è­·ï¼ˆä¾›é¸ç”¨ï¼‰ |
| **API èªè­‰** | å¯é¸çš„ API Key | é è¨­é—œé–‰ï¼Œå¯é€éç’°å¢ƒè®Šæ•¸å•Ÿç”¨ |
| **å®‰å…¨æ¨™é ­** | XSS/CSRF é˜²è­· | X-Frame-Options, X-Content-Type-Options |
| **ä¾è³´ç®¡ç†** | æ¼æ´æƒæ | å·²æ•´åˆ pip-audit |
| **ç„¡è³‡æ–™åº«** | åƒ…è¨˜æ†¶é«”æ“ä½œ | ç„¡ SQL æ³¨å…¥é¢¨éšª |
| **ç„¡æ©Ÿå¯†å„²å­˜** | ç„¡ç‹€æ…‹è¨­è¨ˆ | ä¸å­˜å„²ä»»ä½•æ†‘è­‰ |

> ğŸ“– **è©³ç´° HTTPS éƒ¨ç½²èªªæ˜è«‹åƒè€ƒ [HTTPS éƒ¨ç½²](#-https-éƒ¨ç½²)ã€‚**

---

## ğŸ” å·¥å…·æ¢ç´¢

**é›™å±¤ Key ç³»çµ±**æ˜¯æœ¬å°ˆæ¡ˆçš„æ ¸å¿ƒå‰µæ–°ï¼š

### æ¢ç´¢ç†å¿µ

ç•¶ AI Agent éœ€è¦é†«å­¸è¨ˆç®—å·¥å…·æ™‚ï¼Œä½¿ç”¨**éšå±¤å¼å°èˆª**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è·¯å¾‘ A: ä¾å°ˆç§‘ç¯©é¸                                          â”‚
â”‚  â‘  list_specialties() â†’ ["critical_care", "anesthesiology"]â”‚
â”‚  â‘¡ list_by_specialty("anesthesiology") â†’ [tool_id, ...]    â”‚
â”‚  â‘¢ get_calculator_info("rcri") â†’ åƒæ•¸ã€æ–‡ç»                â”‚
â”‚  â‘£ calculate_rcri(...)                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è·¯å¾‘ B: ä¾è‡¨åºŠæƒ…å¢ƒç¯©é¸                                      â”‚
â”‚  â‘  list_contexts() â†’ ["preoperative_assessment", ...]      â”‚
â”‚  â‘¡ list_by_context("preoperative_assessment") â†’ [tools]    â”‚
â”‚  â‘¢ get_calculator_info("asa_physical_status")              â”‚
â”‚  â‘£ calculate_asa_physical_status(...)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è·¯å¾‘ C: å¿«é€Ÿæœå°‹                                            â”‚
â”‚  â‘  search_calculators("sepsis") â†’ [sofa_score, qsofa, ...] â”‚
â”‚  â‘¡ get_calculator_info("sofa_score")                        â”‚
â”‚  â‘¢ calculate_sofa(...)                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ¯ä¸€æ­¥å›å‚³éƒ½åŒ…å« `next_step` æç¤ºï¼ŒAgent ä¸æœƒè¿·è·¯ï¼**

### ä½éš Key (ç²¾æº–é¸æ“‡)

ç”¨æ–¼**ç²¾ç¢ºå·¥å…·é¸æ“‡**ï¼Œç•¶ä½ ç¢ºåˆ‡çŸ¥é“éœ€è¦ä»€éº¼æ™‚ï¼š

```python
LowLevelKey(
    tool_id="ckd_epi_2021",           # å”¯ä¸€è­˜åˆ¥ç¢¼
    name="CKD-EPI 2021",              # äººé¡å¯è®€åç¨±
    purpose="Calculate eGFR",          # åŠŸèƒ½æè¿°
    input_params=["age", "sex", "creatinine"],  # å¿…è¦è¼¸å…¥åƒæ•¸
    output_type="eGFR with CKD staging"         # è¼¸å‡ºæ ¼å¼
)
```

### æ¢ç´¢ MCP å·¥å…·

| å·¥å…· | èªªæ˜ |
|------|---------|
| `search_calculators(keyword)` | ğŸ” å¿«é€Ÿé—œéµå­—æœå°‹ |
| `list_by_specialty(specialty)` | ä¾é†«å­¸å°ˆç§‘ç¯©é¸å·¥å…· |
| `list_by_context(context)` | ä¾è‡¨åºŠæƒ…å¢ƒç¯©é¸å·¥å…· |
| `list_calculators()` | ğŸ“‹ åˆ—å‡ºæ‰€æœ‰è¨ˆç®—å™¨ |
| `get_calculator_info(tool_id)` | ğŸ“– å–å¾—å·¥å…·çš„å®Œæ•´ metadata |
| `list_specialties()` | ğŸ“‹ åˆ—å‡ºå¯ç”¨å°ˆç§‘ (è¿”å› next_step) |
| `list_contexts()` | ğŸ“‹ åˆ—å‡ºå¯ç”¨è‡¨åºŠæƒ…å¢ƒ (è¿”å› next_step) |

---

## ğŸ”§ å¯ç”¨å·¥å…·

> **MCP åŸºæœ¬å…ƒç´ **: 75 å€‹å·¥å…· + 5 å€‹æç¤ºè© + 4 å€‹è³‡æº
>
> **ç›®å‰çµ±è¨ˆ**: 75 å€‹è¨ˆç®—å™¨ | 940 å€‹æ¸¬è©¦ | 88% è¦†è“‹ç‡ | ç¬¬ 19 éšæ®µå·²å®Œæˆ âœ…

### ğŸ“‘ å¿«é€Ÿå°è¦½

| å°ˆç§‘ | æ•¸é‡ | é€£çµ |
|-----------|-------|---------|
| éº»é†‰ç§‘ / è¡“å‰è©•ä¼° | 9 | [â†’ è·³è½‰](#-éº»é†‰ç§‘--è¡“å‰è©•ä¼°) |
| é‡ç—‡åŠ è­· / ICU | 8 | [â†’ è·³è½‰](#-é‡ç—‡åŠ è­·) |
| å°å…’ç§‘ | 9 | [â†’ è·³è½‰](#-å°å…’ç§‘) |
| è…è‡Ÿç§‘ | 2 | [â†’ è·³è½‰](#-è…è‡Ÿç§‘) |
| èƒ¸è…”ç§‘ | 6 | [â†’ è·³è½‰](#-èƒ¸è…”ç§‘) |
| å¿ƒè‡Ÿç§‘ | 9 | [â†’ è·³è½‰](#-å¿ƒè‡Ÿç§‘) |
| æ€¥è¨ºé†«å­¸ / å‰µå‚· | 5 | [â†’ è·³è½‰](#-æ€¥è¨ºé†«å­¸) |
| è‚è†½æ¶ˆåŒ–ç§‘ | 6 | [â†’ è·³è½‰](#-è‚è†½ç§‘) |
| é…¸é¹¼ä»£è¬ | 4 | [â†’ è·³è½‰](#-é…¸é¹¼ä»£è¬) |
| è¡€æ¶²ç§‘ | 1 | [â†’ è·³è½‰](#-è¡€æ¶²ç§‘) |
| ç¥ç¶“ç§‘ | 7 | [â†’ è·³è½‰](#-ç¥ç¶“ç§‘) |
| é€šç”¨å·¥å…· | 4 | [â†’ è·³è½‰](#-é€šç”¨å·¥å…·) |
| æ¢ç´¢å·¥å…· | 7 | [â†’ è·³è½‰](#-æ¢ç´¢å·¥å…·) |
| æç¤ºè©å·¥ä½œæµç¨‹ | 5 | [â†’ è·³è½‰](#-æç¤ºè©å·¥ä½œæµç¨‹) |

---

### è¨ˆç®—å™¨ (75 å€‹å·¥å…·)

#### ğŸ¥ éº»é†‰ç§‘ / è¡“å‰è©•ä¼°

| å·¥å…· ID | åç¨± | ç”¨é€” | åƒè€ƒæ–‡ç» |
|---------|------|---------|-----------|
| `calculate_asa_physical_status` | ASA-PS | èº«é«”ç‹€æ³åˆ†ç´š | Mayhew 2019 |
| `calculate_mallampati` | Mallampati | å‘¼å¸é“è©•ä¼° | Mallampati 1985 |
| `calculate_rcri` | RCRI (Lee Index) | éå¿ƒè‡Ÿæ‰‹è¡“çš„å¿ƒè‡Ÿé¢¨éšªè©•ä¼° | Lee 1999 |
| `calculate_mabl` | MABL | æœ€å¤§å…è¨±å¤±è¡€é‡ | Gross 1983 |
| `calculate_transfusion_volume` | Transfusion Calc | è¼¸è¡€é‡è¨ˆç®— | Roseff 2002 |
| `calculate_caprini_vte` | Caprini VTE | æ‰‹è¡“ VTE é¢¨éšªè©•ä¼° | Caprini 2005 |
| `calculate_apfel_ponv` | Apfel Score ğŸ†• | è¡“å¾Œå˜”åé¢¨éšªé æ¸¬ | Apfel 1999 |
| `calculate_stop_bang` | STOP-BANG ğŸ†• | OSA ç¯©æª¢å•å· | Chung 2008 |
| `calculate_aldrete_score` | Aldrete Score ğŸ†• | PACU æ¢å¾©è©•ä¼° | Aldrete 1970 |

[â†‘ è¿”å›å°è¦½](#-å¿«é€Ÿå°è¦½)

#### ğŸ©º é‡ç—‡åŠ è­·

| å·¥å…· ID | åç¨± | ç”¨é€” | åƒè€ƒæ–‡ç» |
|---------|------|---------|-----------|
| `calculate_apache_ii` | APACHE II | ICU æ­»äº¡ç‡é æ¸¬ | Knaus 1985 |
| `calculate_sofa` | SOFA Score | å™¨å®˜è¡°ç«­è©•ä¼° (Sepsis-3) | Vincent 1996, Singer 2016 |
| `calculate_sofa2` | **SOFA-2 (2025)** ğŸ†• | æ›´æ–°ç‰ˆå™¨å®˜è¡°ç«­è©•ä¼° | Ranzani JAMA 2025 |
| `calculate_qsofa` | qSOFA | åºŠé‚Šæ•—è¡€ç—‡å¿«é€Ÿç¯©æª¢ | Singer 2016 (Sepsis-3) |
| `calculate_news2` | NEWS2 | è‡¨åºŠæƒ¡åŒ–é è­¦åˆ†æ•¸ | RCP 2017 |
| `calculate_gcs` | Glasgow Coma Scale | æ„è­˜ç‹€æ…‹è©•ä¼° (æ˜è¿·æŒ‡æ•¸) | Teasdale 1974 |
| `calculate_rass` | RASS | é®éœ/èºå‹•è©•ä¼°é‡è¡¨ | Sessler 2002 |
| `calculate_cam_icu` | CAM-ICU | ICU ç»å¦„ç¯©æª¢ | Ely 2001 |

[â†‘ è¿”å›å°è¦½](#-å¿«é€Ÿå°è¦½)

#### ğŸ‘¶ å°å…’ç§‘

| å·¥å…· ID | åç¨± | ç”¨é€” | åƒè€ƒæ–‡ç» |
|---------|------|---------|-----------|
| `calculate_apgar_score` | APGAR Score ğŸ†• | æ–°ç”Ÿå…’è©•ä¼° (1, 5, 10 åˆ†é˜) | Apgar 1953, AAP 2015 |
| `calculate_pews` | PEWS ğŸ†• | å°å…’æ—©æœŸé è­¦åˆ†æ•¸ | Parshuram 2009 |
| `calculate_pediatric_sofa` | pSOFA ğŸ†• | å°å…’å™¨å®˜è¡°ç«­è©•ä¼° (æ•—è¡€ç—‡) | Matics 2017 |
| `calculate_pim3` | PIM3 ğŸ†• | PICU æ­»äº¡ç‡é æ¸¬ | Straney 2013 |
| `calculate_pediatric_gcs` | Pediatric GCS ğŸ†• | å…’ç«¥ç‰ˆæ„è­˜è©•ä¼°é‡è¡¨ | Reilly 1988 |
| `calculate_pediatric_drug_dose` | Pediatric Dosing | é«”é‡ä¾è³´å‹è—¥ç‰©åŠ‘é‡è¨ˆç®— | Lexicomp, Anderson 2017 |
| `calculate_mabl` | MABL | æœ€å¤§å…è¨±å¤±è¡€é‡ | Miller's Anesthesia |
| `calculate_transfusion_volume` | Transfusion Volume | è¼¸è¡€é‡è¨ˆç®— | AABB |
| `calculate_body_surface_area` | BSA | é«”è¡¨é¢ç©è¨ˆç®— (Mosteller) | Mosteller 1987 |

[â†‘ è¿”å›å°è¦½](#-å¿«é€Ÿå°è¦½)

#### ğŸ«˜ è…è‡Ÿç§‘

| å·¥å…· ID | åç¨± | ç”¨é€” | åƒè€ƒæ–‡ç» |
|---------|------|---------|-----------|
| `calculate_ckd_epi_2021` | CKD-EPI 2021 | ä¼°è¨ˆè…çµ²çƒéæ¿¾ç‡ (eGFR) | Inker 2021 |
| `calculate_kdigo_aki` | KDIGO AKI | æ€¥æ€§è…æå‚·åˆ†æœŸ | KDIGO 2012 |

[â†‘ è¿”å›å°è¦½](#-å¿«é€Ÿå°è¦½)

#### ğŸ« èƒ¸è…”ç§‘

| å·¥å…· ID | åç¨± | ç”¨é€” | åƒè€ƒæ–‡ç» |
|---------|------|---------|-----------|
| `calculate_curb65` | CURB-65 | è‚ºç‚åš´é‡åº¦è©•ä¼° | Lim 2003 |
| `calculate_psi_port` | PSI/PORT | ç¤¾å€å‹è‚ºç‚æ­»äº¡ç‡é æ¸¬ | Fine 1997 |
| `calculate_ideal_body_weight` | IBW (Devine) | ç†æƒ³é«”é‡é ä¼° (å‘¼å¸å™¨è¨­å®š) | Devine 1974, ARDSNet 2000 |
| `calculate_pf_ratio` | P/F Ratio | ARDS æŸæ—å®šç¾©åˆ†é¡ | ARDS Task Force 2012 |
| `calculate_rox_index` | ROX Index | é«˜æµé‡æ°§æ°£å¤±æ•—é æ¸¬ | Roca 2016 |
| `calculate_spesi` | sPESI ğŸ†• | ç°¡åŒ–ç‰ˆè‚ºæ “å¡åš´é‡åº¦æŒ‡æ•¸ | JimÃ©nez 2010 |

[â†‘ è¿”å›å°è¦½](#-å¿«é€Ÿå°è¦½)

#### â¤ï¸ å¿ƒè‡Ÿç§‘

| å·¥å…· ID | åç¨± | ç”¨é€” | åƒè€ƒæ–‡ç» |
|---------|------|---------|-----------|
| `calculate_chads2_vasc` | CHAâ‚‚DSâ‚‚-VASc | å¿ƒæˆ¿é¡«å‹•ä¸­é¢¨é¢¨éšªè©•ä¼° | Lip 2010 |
| `calculate_chads2_va` | CHAâ‚‚DSâ‚‚-VA (2024 ESC) | æ€§åˆ¥ä¸­æ€§ç‰ˆ AF ä¸­é¢¨é¢¨éšª | Van Gelder 2024 |
| `calculate_has_bled` | HAS-BLED | AF å‡ºè¡€é¢¨éšªè©•ä¼° | Pisters 2010, ESC 2024 |
| `calculate_heart_score` | HEART Score | èƒ¸ç—›é¢¨éšªåˆ†å±¤ | Six 2008 |
| `calculate_corrected_qt` | Corrected QT (QTc) | è—¥ç‰©å®‰å…¨æ€§ä¹‹ QT é–“éš”æ ¡æ­£ | Bazett 1920, ESC 2015 |
| `calculate_grace_score` | GRACE Score | ACS æ­»äº¡é¢¨éšªåˆ†å±¤ | Fox 2006 |
| `calculate_acef_ii` | ACEF II Score | å¿ƒè‡Ÿæ‰‹è¡“æ­»äº¡é¢¨éšª | Ranucci 2018 |
| `calculate_timi_stemi` | TIMI STEMI ğŸ†• | STEMI 30å¤©æ­»äº¡ç‡é æ¸¬ | Morrow 2000 |

[â†‘ è¿”å›å°è¦½](#-å¿«é€Ÿå°è¦½)

#### ğŸ§  ç¥ç¶“ç§‘

| å·¥å…· ID | åç¨± | ç”¨é€” | åƒè€ƒæ–‡ç» |
|---------|------|---------|-----------|
| `calculate_nihss` | NIHSS | ç¾åœ‹åœ‹è¡›é™¢è…¦ä¸­é¢¨é‡è¡¨ (è…¦ä¸­é¢¨åš´é‡åº¦) | Brott 1989 |
| `calculate_abcd2` | ABCD2 Score | TIA çŸ­æœŸä¸­é¢¨é¢¨éšªé æ¸¬ | Johnston 2007 |
| `calculate_modified_rankin_scale` | Modified Rankin Scale | ä¸­é¢¨å¾Œå¤±èƒ½ç‹€æ…‹è©•ä¼° | van Swieten 1988 |
| `calculate_hunt_hess` | Hunt & Hess Scale ğŸ†• | èœ˜è››è†œä¸‹è…”å‡ºè¡€è‡¨åºŠåˆ†ç´š | Hunt & Hess 1968 |
| `calculate_fisher_grade` | Fisher Grade ğŸ†• | SAH CT åˆ†ç´š (è¡€ç®¡ç—™æ”£é æ¸¬) | Fisher 1980, Frontera 2006 |
| `calculate_four_score` | FOUR Score ğŸ†• | æ˜è¿·è©•ä¼° (E/M/B/R, 0-16) | Wijdicks 2005 |
| `calculate_ich_score` | ICH Score ğŸ†• | è…¦å…§å‡ºè¡€ 30å¤©æ­»äº¡ç‡ | Hemphill 2001 |

[â†‘ è¿”å›å°è¦½](#-å¿«é€Ÿå°è¦½)

#### ğŸ§ª é…¸é¹¼ä»£è¬

| å·¥å…· ID | åç¨± | ç”¨é€” | åƒè€ƒæ–‡ç» |
|---------|------|---------|-----------|
| `calculate_anion_gap` | Anion Gap | ä»£è¬æ€§é…¸ä¸­æ¯’é‘‘åˆ¥è¨ºæ–· | Kraut 2007, Figge 1998 |
| `calculate_delta_ratio` | Delta Ratio | æ··åˆæ€§é…¸é¹¼å¤±è¡¡åµæ¸¬ | Wrenn 1990, Rastegar 2007 |
| `calculate_corrected_sodium` | Corrected Sodium | é«˜è¡€ç³–ä¸‹è¡€éˆ‰æ ¡æ­£ | Katz 1973, Hillier 1999 |
| `calculate_winters_formula` | Winter's Formula | ä»£è¬æ€§é…¸ä¸­æ¯’ä¹‹é æœŸ PaCOâ‚‚ | Albert 1967, Narins 1980 |
| `calculate_osmolar_gap` | Osmolar Gap | æ¯’æ€§é…’ç²¾ç¯©æª¢ | Hoffman 1993, Lynd 2008 |
| `calculate_free_water_deficit` | Free Water Deficit | é«˜è¡€éˆ‰æ²»ç™‚è£œæ°´è¨ˆç•« | Adrogue 2000, Sterns 2015 |
| `calculate_aa_gradient` | A-a Gradient | è‚ºæ³¡-å‹•è„ˆæ°§åˆ†å£“å·® | Kanber 1968, West 2016 |

[â†‘ è¿”å›å°è¦½](#-å¿«é€Ÿå°è¦½)

---

### ğŸ“ æç¤ºè©å·¥ä½œæµç¨‹

| æç¤ºè© | èªªæ˜ |
|--------|-------------|
| `sepsis_evaluation` | qSOFA â†’ SOFA â†’ RASS â†’ CAM-ICU æµç¨‹ |
| `preoperative_risk_assessment` | ASA â†’ RCRI â†’ Mallampati æµç¨‹ |
| `icu_daily_assessment` | RASS â†’ CAM-ICU â†’ GCS â†’ SOFA æ¯æ—¥å·¡æˆ¿æµç¨‹ |
| `pediatric_drug_dosing` | é«”é‡ä¾è³´åŠ‘é‡ + MABL + è¼¸è¡€é‡æµç¨‹ |
| `acute_kidney_injury_assessment` | CKD-EPI + AKI åˆ†æœŸè©•ä¼°æµç¨‹ |

---

## ğŸ“– ä½¿ç”¨ç¯„ä¾‹

### Python ç¯„ä¾‹ â­ NEW

å°ˆæ¡ˆåœ¨ `examples/` è³‡æ–™å¤¾ä¸­åŒ…å«å¯ç›´æ¥åŸ·è¡Œçš„ç¯„ä¾‹è…³æœ¬ï¼š

```bash
# åŸºæœ¬ä½¿ç”¨ç¯„ä¾‹
python examples/basic_usage.py

# è‡¨åºŠå·¥ä½œæµç¨‹ç¯„ä¾‹
python examples/clinical_workflows.py
```

### ç¯„ä¾‹ï¼šCKD-EPI 2021 (eGFR)

**è¼¸å…¥:**
```json
{
  "serum_creatinine": 1.2,
  "age": 65,
  "sex": "female"
}
```

**è¼¸å‡º:**
```json
{
  "score_name": "CKD-EPI 2021",
  "result": 67.1,
  "unit": "mL/min/1.73mÂ²",
  "interpretation": {
    "summary": "è…åŠŸèƒ½è¼•åº¦é™ä½ (G2)",
    "stage": "G2",
    "recommendation": "æ¯å¹´ç›£æ¸¬è…åŠŸèƒ½ï¼›èª¿æ•´ç¶“è…è‡Ÿæ’æ³„ä¹‹è—¥ç‰©åŠ‘é‡"
  }
}
```

---

## ğŸ‘¨â€ğŸ’» é–‹ç™¼æŒ‡å—

### å¿«é€Ÿé–‹å§‹ (é–‹ç™¼è€…)

```bash
# 1. å®‰è£ uv
curl -LsSf https://astral.sh/uv/install.sh | sh

# 2. è¨­å®šç’°å¢ƒä¸¦å®‰è£ä¾è³´
uv sync

# 3. åŸ·è¡Œæ¸¬è©¦
uv run pytest

# 4. åœ¨é–‹ç™¼æ¨¡å¼ä¸‹åŸ·è¡Œ MCP ä¼ºæœå™¨
uv run mcp dev src/main.py
```

---

## ğŸ§ª æ¸¬è©¦

### æ¸¬è©¦ç­–ç•¥

æˆ‘å€‘ç¶­æŒé«˜å“è³ªçš„ç¨‹å¼ç¢¼åº«ï¼Œæ“æœ‰è¶…é **1640+ å€‹æ¸¬è©¦**èˆ‡ **90% çš„ç¨‹å¼ç¢¼è¦†è“‹ç‡**ã€‚

```bash
# åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
uv run pytest

# åŸ·è¡Œä¸¦è¨ˆç®—è¦†è“‹ç‡
uv run pytest --cov=src --cov-report=html
```

---

## ğŸ› ï¸ éœ€æ±‚

- **Python 3.11+**
- **uv** (å»ºè­°ç”¨æ–¼å¥—ä»¶ç®¡ç†)
- **MCP SDK** (FastMCP)

---

## ğŸ“„ æˆæ¬Šå”è­°

Apache 2.0 - è©³è¦‹ [LICENSE](LICENSE)

---

## ğŸ™ è‡´è¬

- [Model Context Protocol](https://modelcontextprotocol.io/) - Anthropic æå‡ºçš„é–‹æº AI-å·¥å…·é€šè¨Šå”å®š
- [FastMCP](https://github.com/modelcontextprotocol/python-sdk) - MCP çš„ Python SDK
- æ‰€æœ‰è¢«å¼•ç”¨é†«å­¸è¨ˆç®—å…¬å¼èˆ‡è©•åˆ†ç³»çµ±çš„åŸå§‹ä½œè€…
